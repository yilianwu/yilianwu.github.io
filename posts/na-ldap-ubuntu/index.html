<!DOCTYPE html>
<html lang="zh-tw"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="ecnbl87JwcfWTJMChfv-5hv5Oui6nsHqvaTr0ha3Mjg" />
    <title>[ yilianwu ]</title>
    <link rel="shortcut icon" href="img/favicon.ico">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
	  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">

    <link rel="stylesheet" href="https://yilianwu.github.io/css/styles.css">
    <link rel="stylesheet" href="https://yilianwu.github.io/css/font.css">
    <link rel="stylesheet" href="https://yilianwu.github.io/css/dosstyle.css">
</head>
<body><header>
    <nav class="breadcrumb" id="breadcrumb">
	     <h4><a href="/">[ yilianwu ]</a></h4>
	       
            
            <a href="/info">INFO</a>
            
            <a href="/posts">POSTS</a>
            
            <a href="/works">WORKS</a>
            
    </nav>
    <div class="menutime">
      <a id='cd' ></a>
      <a id='ct' ></a>
      <script type="text/javascript" src="/js/menutime.js"></script>
    </div>
            
    
</header>

<main id="single">
  <div id="post" class="white">
	   <div class="container">
        <div class="post-toc" id="post-toc">
            <h2 class="post-toc-title">Contents</h2>
            <nav id="TableOfContents">
<ul>
<li><a href="#vm-host-only-adapter">VM Host-Only Adapter</a></li>
<li><a href="#nameserver-setting">NameServer Setting</a>
<ul>
<li><a href="#debug">Debug</a></li>
</ul></li>
<li><a href="#slapd">Slapd</a></li>
<li><a href="#phpldapadmin">phpLDAPadmin</a>
<ul>
<li><a href="#install-phpldapadmin">Install phpLDAPadmin</a></li>
<li><a href="#apache">Apache</a>
<ul>
<li><a href="#create-ssl-certificate">Create SSL Certificate</a></li>
<li><a href="#create-a-password-authentication-file">Create a Password Authentication File</a></li>
<li><a href="#secure-apache">Secure Apache</a></li>
<li><a href="#modify-the-phpldapadmin-apache-configuration">Modify the phpLDAPadmin Apache Configuration</a></li>
<li><a href="#configure-the-http-virtual-host">Configure the HTTP Virtual Host</a></li>
<li><a href="#configure-the-https-virtual-host-file">Configure the HTTPS Virtual Host File</a></li>
</ul></li>
<li><a href="#debug-1">Debug</a></li>
<li><a href="#log-into-the-phpldapadmin-web-interface">Log into the phpLDAPadmin Web Interface</a></li>
<li><a href="#create-users">Create Users</a></li>
<li><a href="#openldap-configuration-layout">OpenLDAP Configuration Layout</a>
<ul>
<li><a href="#add-olcrootdn">Add olcRootDN</a></li>
</ul></li>
<li><a href="#extending-schema">Extending Schema</a>
<ul>
<li><a href="#ludou">ludou</a></li>
<li><a href="#publickey">publicKey</a></li>
</ul></li>
<li><a href="#back-to-phpldapadmin">Back to phpLDAPadmin</a>
<ul>
<li><a href="#olcaccess">olcAccess</a></li>
<li><a href="#new-objectclass">New objectClass</a>
<ul>
<li><a href="#ludou-1">ludou</a></li>
<li><a href="#publickey-1">publicKey</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#starttls">STARTTLS</a>
<ul>
<li><a href="#server-settings">Server Settings</a>
<ul>
<li><a href="#install-the-ssl-components">Install the SSL Components</a></li>
<li><a href="#create-the-certificate-templates">Create the Certificate Templates</a></li>
<li><a href="#create-the-ca-template">Create the CA Template</a></li>
<li><a href="#create-the-ldap-service-template">Create the LDAP Service Template</a></li>
<li><a href="#create-ca-key-and-certificate">Create CA Key and Certificate</a></li>
<li><a href="#create-ldap-service-key-and-certificate">Create LDAP Service Key and Certificate</a></li>
<li><a href="#give-openldap-access-to-the-ldap-server-key">Give OpenLDAP Access to the LDAP Server Key</a></li>
<li><a href="#configure-openldap-to-use-the-certificate-and-keys">Configure OpenLDAP to Use the Certificate and Keys</a></li>
</ul></li>
<li><a href="#client-settings">Client Settings</a></li>
<li><a href="#dns-txt-record">DNS TXT Record</a></li>
</ul></li>
<li><a href="#specs-of-ludoucredit-about-user-account-and-ssh-login">Specs of ludouCredit about User Account and SSH Login:</a></li>
<li><a href="#totp">TOTP</a>
<ul>
<li><a href="#configure-module-totp">Configure Module TOTP</a></li>
</ul></li>
<li><a href="#snmp">SNMP</a></li>
<li><a href="#firewall">Firewall</a></li>
</ul>
</nav>
        </div>
       <div class="paperbg">
            <div id="title">
                <h1>LDAP &amp; SNMP on Ubuntu 18.04</h1>
                
	          </div>
            <div class="post-meta">
                <span class="post-time"> 2020-06-14 </span>
                <div class="post-tag">
                  
                    <a class="tag-link" href="/tags/ubuntu/"> Ubuntu </a>
                    <a class="tag-link" href="/tags/ldap/"> LDAP </a>
                    <a class="tag-link" href="/tags/slapd/"> slapd </a>
                    <a class="tag-link" href="/tags/phpldapadmin/"> phpLDAPadmin </a>
                    <a class="tag-link" href="/tags/snmp/"> SNMP </a>
                    </div>

                <section class="post-content">
                

<h1 id="vm-host-only-adapter">VM Host-Only Adapter&nbsp;<a class="anchor" href="#vm-host-only-adapter"><i class="small linkify icon"></i></a> </h1>

<p>Ubuntu 好像要手動開interface</p>

<pre><code>ls /etc/netplan
</code></pre>

<p>file <code>50-cloud-init.yaml</code></p>

<pre><code>sudo vim /etc/netplan/50-cloud-init.yaml
</code></pre>

<p>把網卡<code>enp0s8</code>加上去</p>

<pre><code>network:
    ethernets:
        enp0s3:
            dhcp4: true
        enp0s8:
            dhcp4: true
    version: 2
</code></pre>

<pre><code>sudo netplan generate
sudo netplan apply
</code></pre>

<h1 id="nameserver-setting">NameServer Setting&nbsp;<a class="anchor" href="#nameserver-setting"><i class="small linkify icon"></i></a> </h1>

<pre><code>sudo vim /etc/netplan/50-cloud-init.yaml
</code></pre>

<p><code>enp0s3</code>加上nameservers</p>

<pre><code>network:
    ethernets:
        enp0s3:
            dhcp4: true
            nameservers:
                search: [ 0846101.nasa ]
        enp0s8:
            dhcp4: true
    version: 2
</code></pre>

<pre><code>netplan try
</code></pre>

<p>確認無誤按enter</p>

<pre><code>systemd-resolve --status
</code></pre>

<pre><code>DNS Domain: 0846101.nasa &lt;-- Check this value
</code></pre>

<h2 id="debug">Debug&nbsp;<a class="anchor" href="#debug"><i class="small linkify icon"></i></a> </h2>

<p><code>resolv.conf</code> 再重新開機後會一直reset成<code>127.0.0.53</code></p>

<p>把正確 dhcp發配的nameserver link 過去</p>

<pre><code>sudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf
</code></pre>

<p><a href="https://askubuntu.com/questions/1128536/how-to-make-persistent-changes-to-etc-resolv-conf-ubuntu-18-10">https://askubuntu.com/questions/1128536/how-to-make-persistent-changes-to-etc-resolv-conf-ubuntu-18-10</a></p>

<h1 id="slapd">Slapd&nbsp;<a class="anchor" href="#slapd"><i class="small linkify icon"></i></a> </h1>

<pre><code>sudo apt install slapd ldap-utils
</code></pre>

<p>LDAP使用的TCP連接埠為389，可以使用以下指令來查看slapd是否有確實安裝成功</p>

<pre><code>sudo netstat -tulnp | grep slapd
</code></pre>

<p>簡單的設定一下</p>

<pre><code>sudo dpkg-reconfigure slapd
</code></pre>

<p>Omit OpenLDAP server configuration? <strong>No</strong></p>

<p>DNS domain name? <strong>0846101.nasa</strong></p>

<p>Organization name? <strong>0846101.nasa</strong></p>

<p>Dtabase backend to use? <strong>MDB</strong></p>

<p>Do you want the database to be removed when slapd is plurged? <strong>No</strong></p>

<p>Move old database? <strong>Yes</strong></p>

<p><a href="https://magiclen.org/ubuntu-server-ldap/">https://magiclen.org/ubuntu-server-ldap/</a></p>

<h1 id="phpldapadmin">phpLDAPadmin&nbsp;<a class="anchor" href="#phpldapadmin"><i class="small linkify icon"></i></a> </h1>

<p>安裝方便管理LDAP的好用工具</p>

<h2 id="install-phpldapadmin">Install phpLDAPadmin&nbsp;<a class="anchor" href="#install-phpldapadmin"><i class="small linkify icon"></i></a> </h2>

<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-openldap-and-phpldapadmin-on-an-ubuntu-14-04-server">https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-openldap-and-phpldapadmin-on-an-ubuntu-14-04-server</a></p>

<p><a href="https://stackoverflow.com/questions/50698477/cant-create-new-entry-phpldapadmin">https://stackoverflow.com/questions/50698477/cant-create-new-entry-phpldapadmin</a></p>

<pre><code>sudo apt-get install phpldapadmin
</code></pre>

<pre><code>sudo vim /etc/phpldapadmin/config.php
</code></pre>

<p>line 286<br />
identify this LDAP server</p>

<pre><code>$servers-&gt;setValue('server','name','My LDAP Server');
</code></pre>

<p>line 293<br />
決定你怎麼從browser連到phpLDAPadmin:<br />
server domain name or IP</p>

<pre><code>$servers-&gt;setValue('server','host','ldap1.0846101.nasa');
</code></pre>

<p>line 300</p>

<pre><code>$servers-&gt;setValue('server','base',array('dc=0846101,dc=nasa'));
</code></pre>

<p>line 326</p>

<pre><code>$servers-&gt;setValue('login','bind_id','cn=admin,cn=config');
</code></pre>

<p>line 161</p>

<pre><code>/* Hide the warnings for invalid objectClasses/attributes in templates. */
$config-&gt;custom-&gt;appearance['hide_template_warning'] = true;
</code></pre>

<h2 id="apache">Apache&nbsp;<a class="anchor" href="#apache"><i class="small linkify icon"></i></a> </h2>

<h3 id="create-ssl-certificate">Create SSL Certificate&nbsp;<a class="anchor" href="#create-ssl-certificate"><i class="small linkify icon"></i></a> </h3>

<p>To secure the external connection to our browser when we connect<br />
We just need to set up a self-signed SSL certificate that our server can use. This will not help us validate the identity of the server, but it will allow us to encrypt our messages</p>

<p>Create a directory to hold our certificate and key</p>

<pre><code>sudo mkdir /etc/apache2/ssl
</code></pre>

<p>Create the key and certificate</p>

<pre><code>sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt
</code></pre>

<h3 id="create-a-password-authentication-file">Create a Password Authentication File&nbsp;<a class="anchor" href="#create-a-password-authentication-file"><i class="small linkify icon"></i></a> </h3>

<p>Even though phpLDAPadmin has password authentication, we also want to password protect our phpLDAPadmin location which will provide an extra level of protection</p>

<pre><code>sudo apt-get install apache2-utils
</code></pre>

<p>Create a password file that will contain a username that you choose and the associated hashed password.</p>

<pre><code>sudo htpasswd -c /etc/apache2/htpasswd c0846101
</code></pre>

<h3 id="secure-apache">Secure Apache&nbsp;<a class="anchor" href="#secure-apache"><i class="small linkify icon"></i></a> </h3>

<p>Enable the SSL module in Apache</p>

<pre><code>sudo a2enmod ssl
</code></pre>

<p>Currently, Apache is reading a file called <code>000-default.conf</code> for regular, unencrypted HTTP connections. We need to tell it to redirect requests for our phpLDAPadmin interface to our HTTPS interface so that the connection is encrypted.</p>

<p>When we redirect traffic to use our SSL certificates, we’ll also implement the password file to authenticate users. While we’re modifying things, we’ll also change the location of the phpLDAPadmin interface itself to minimize targeted attacks.</p>

<h3 id="modify-the-phpldapadmin-apache-configuration">Modify the phpLDAPadmin Apache Configuration&nbsp;<a class="anchor" href="#modify-the-phpldapadmin-apache-configuration"><i class="small linkify icon"></i></a> </h3>

<p>The default URL is ldap1.0846101.nasa/phpldapadmin (10.113.25.10/phpldapadmin)</p>

<pre><code>sudo vim /etc/phpldapadmin/apache.conf
</code></pre>

<p><code>/phpldapadmin</code> can be replaced</p>

<pre><code># Define /phpldapadmin alias, this is the default
&lt;IfModule mod_alias.c&gt;
    Alias /phpldapadmin /usr/share/phpldapadmin/htdocs
&lt;/IfModule&gt;
</code></pre>

<h3 id="configure-the-http-virtual-host">Configure the HTTP Virtual Host&nbsp;<a class="anchor" href="#configure-the-http-virtual-host"><i class="small linkify icon"></i></a> </h3>

<pre><code>sudo vim /etc/apache2/sites-enabled/000-default.conf
</code></pre>

<pre><code>&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@ldap1.0846101.nasa
    DocumentRoot /var/www/html
    ServerName ldap1.0846101.nasa
#   Redirect permanent /superldap https://server_domain_or_IP/superldap
    ...
&lt;/VirtualHost&gt;
</code></pre>

<h3 id="configure-the-https-virtual-host-file">Configure the HTTPS Virtual Host File&nbsp;<a class="anchor" href="#configure-the-https-virtual-host-file"><i class="small linkify icon"></i></a> </h3>

<p>Apache includes a default SSL Virtual Host file.<br />
However, it is not enabled by default.</p>

<p>We can enable it by typing:</p>

<pre><code>sudo a2ensite default-ssl.conf
</code></pre>

<p>This will link the file from the <code>sites-available</code> directory into the <code>sites-enabled</code> directory.<br />
We can edit this file now by typing:</p>

<pre><code>sudo vim /etc/apache2/sites-enabled/default-ssl.conf
</code></pre>

<pre><code>ServerAdmin webmaster@ldap1.0846101.nasa
ServerName ldap1.0846101.nasa

SSLCertificateFile /etc/apache2/ssl/apache.crt
SSLCertificateKeyFile /etc/apache2/ssl/apache.key
</code></pre>

<p>The last thing we need to do is set up the location block that will implement our password protection for the entire phpLDAPadmin installation.</p>

<p>We do this by referencing the location where we are serving the phpLDAPadmin and setting up authentication using the file we generated. We will require anyone attempting to access this content to authenticate as a valid user:<br />
(我沒做)</p>

<pre><code>&lt;Location /phpldapadmin&gt;
    AuthType Basic
    AuthName &quot;Restricted Files&quot;
    AuthUserFile /etc/apache2/htpasswd
    Require c0846101
&lt;/Location&gt;
</code></pre>

<p>Restart Apache to implement all of the changes that we have made:</p>

<pre><code>sudo systemctl restart apache2
</code></pre>

<h2 id="debug-1">Debug&nbsp;<a class="anchor" href="#debug-1"><i class="small linkify icon"></i></a> </h2>

<p>Unrecognized error number: 8192: Function create_function() is deprecated</p>

<p>Bacup</p>

<pre><code>sudo cp /usr/share/phpldapadmin/lib/functions.php /usr/share/phpldapadmin/lib/functions.php.backup
</code></pre>

<p>Make some changes to this file</p>

<pre><code>sudo vim /usr/share/phpldapadmin/lib/functions.php
</code></pre>

<p>change line 54 to</p>

<pre><code>function my_autoload($className) {
</code></pre>

<p>Add this code on line 777</p>

<pre><code>spl_autoload_register(&quot;my_autoload&quot;);
</code></pre>

<p>change line 1083 to</p>

<pre><code>$CACHE[$sortby] = __create_function('$a, $b',$code);
</code></pre>

<p>add the code below on line 1091 from the</p>

<pre><code>   function __create_function($arg, $body) {
        static $cache = array();
        static $maxCacheSize = 64;
        static $sorter;

        if ($sorter === NULL) {
            $sorter = function($a, $b) {
                if ($a-&gt;hits == $b-&gt;hits) {
                    return 0;
                }

                return ($a-&gt;hits &lt; $b-&gt;hits) ? 1 : -1;
            };
        }

        $crc = crc32($arg . &quot;\\x00&quot; . $body);

        if (isset($cache[$crc])) {
            ++$cache[$crc][1];
            return $cache[$crc][0];
        }

        if (sizeof($cache) &gt;= $maxCacheSize) {
            uasort($cache, $sorter);
            array_pop($cache);
        }

        $cache[$crc] = array($cb = eval('return 
    function('.$arg.'){'.$body.'};'), 0);
        return $cb;
    }
</code></pre>

<pre><code>sudo systemctl restart apache2
</code></pre>

<h2 id="log-into-the-phpldapadmin-web-interface">Log into the phpLDAPadmin Web Interface&nbsp;<a class="anchor" href="#log-into-the-phpldapadmin-web-interface"><i class="small linkify icon"></i></a> </h2>

<p><img src="https://i.imgur.com/M0IzFLO.png" alt="Imgur" /></p>

<p>login with <code>cn=admin,dc=0846101,dc=nasa</code><br />
<img src="https://i.imgur.com/AMEosGm.png" alt="Imgur" /></p>

<h2 id="create-users">Create Users&nbsp;<a class="anchor" href="#create-users"><i class="small linkify icon"></i></a> </h2>

<p>創ou=People<br />
<img src="https://i.imgur.com/9QsYgyN.png" alt="Imgur" />
<img src="https://i.imgur.com/jaZ0tYS.png" alt="Imgur" /></p>

<p>創建ou=People下面的User之前，要先創group，名稱隨便<br />
ou=Group<br />
<img src="https://i.imgur.com/9QsYgyN.png" alt="Imgur" />
<img src="https://i.imgur.com/GHFrR8c.png" alt="Imgur" /></p>

<p>ou=Group下面再創一個posixGroup<br />
cn=ldap<br />
<img src="https://i.imgur.com/WkLpT3H.png" alt="Imgur" /></p>

<p>就可以在ou=People下面創建Users了<br />
<img src="https://i.imgur.com/nmEV4Jr.png" alt="Imgur" />
<img src="https://i.imgur.com/0GEUJb8.png" alt="Imgur" /></p>

<h2 id="openldap-configuration-layout">OpenLDAP Configuration Layout&nbsp;<a class="anchor" href="#openldap-configuration-layout"><i class="small linkify icon"></i></a> </h2>

<p><a href="https://www.openldap.org/doc/admin24/slapdconf2.html">https://www.openldap.org/doc/admin24/slapdconf2.html</a></p>

<p>The slapd configuration is stored as a special LDAP directory with a predefined schema and DIT.<br />
There are specific objectClasses used to carry global configuration options, schema definitions, backend and database definitions, and assorted other items.</p>

<p><img src="https://i.imgur.com/5zXcj4d.png" alt="Imgur" /></p>

<p>The root of the tree is named <code>cn=config</code><br />
and contains global configuration settings.<br />
Additional settings are contained in separate child entries.</p>

<p>要可以custom classObject, attributeType<br />
要開啟這個欄位<br />
<img src="https://i.imgur.com/xk2wfvM.png" alt="Imgur" /></p>

<h3 id="add-olcrootdn">Add olcRootDN&nbsp;<a class="anchor" href="#add-olcrootdn"><i class="small linkify icon"></i></a> </h3>

<p>This directive specifies the DN that is not subject to access control or administrative limit restrictions for operations on this database.<br />
The DN need not refer to an entry in this database or even in the directory. The DN may refer to a SASL identity.</p>

<p>新增olcRootDN:cn=admin,cn=config<br />
以後登入phpLDAPadmin要用<code>cn=admin,cn=config</code>來管理</p>

<pre><code>sudo vim add_adminconfig.ldif
</code></pre>

<pre><code>dn: cn=config
changetype: modify

dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcRootDN
olcRootDN: cn=admin,cn=config

dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcRootPW
olcRootPW: {SSHA}MxvXZI4FDupYfJc6LBRMuPintCuI967N
</code></pre>

<p>olcRootPW要hash過</p>

<pre><code>slappasswd -h {SSHA}
</code></pre>

<pre><code>sudo ldapmodify -Y EXTERNAL -H ldapi:/// -f /home/c0846101/add_adminconfig.ldif
</code></pre>

<p><img src="https://i.imgur.com/ciMBF7S.png" alt="Imgur" /></p>

<p>其他設定</p>

<pre><code>sudo vim /etc/phpldapadmin/config.php
</code></pre>

<p>line 300</p>

<pre><code>$servers-&gt;setValue('server','base',array('cn=config','dc=0846101,dc=nasa'));
</code></pre>

<p>line 326</p>

<pre><code>$servers-&gt;setValue('login','bind_id','cn=admin,cn=config');
</code></pre>

<h2 id="extending-schema">Extending Schema&nbsp;<a class="anchor" href="#extending-schema"><i class="small linkify icon"></i></a> </h2>

<p><a href="https://www.openldap.org/doc/admin24/schema.html">https://www.openldap.org/doc/admin24/schema.html</a></p>

<h3 id="ludou">ludou&nbsp;<a class="anchor" href="#ludou"><i class="small linkify icon"></i></a> </h3>

<pre><code>sudo vim ludou.ldif
</code></pre>

<pre><code>dn: cn=ludou,cn=schema,cn=config
objectClass: olcSchemaConfig
cn: ludou
olcAttributeTypes: ( 1.1.2.1.1
 NAME 'ludoucredit'
 DESC 'login credit value'
 EQUALITY integerMatch
 ORDERING integerOrderingMatch
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
 SINGLE-VALUE )
olcObjectClasses: ( 1.1.2.2.1
 NAME 'ludouCredit'
 DESC 'login credit class'
 SUP top
 AUXILIARY
 MUST ludoucredit )
</code></pre>

<p>ldapadd &ndash;&gt; 新增olcAttribute<br />
ldapreplace &ndash;&gt; 修改已存在的</p>

<pre><code>sudo ldapadd -Y EXTERNAL -H ldapi:/// -f ludou.ldif
</code></pre>

<h3 id="publickey">publicKey&nbsp;<a class="anchor" href="#publickey"><i class="small linkify icon"></i></a> </h3>

<pre><code>sudo vim publickey.ldif
</code></pre>

<pre><code>dn: cn=pubkey,cn=schema,cn=config
objectClass: olcSchemaConfig
cn: pubkey
olcAttributeTypes: ( 1.1.2.1.2
 NAME 'sshPublicKey'
 DESC 'ssh public key'
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.26 )
olcObjectClasses: ( 1.1.2.2.2
 NAME 'publicKeyLogin'
 DESC 'ssh public key class'
 SUP top
 AUXILIARY
 MAY sshPublicKey )
</code></pre>

<pre><code>sudo ldapadd -Y EXTERNAL -H ldapi:/// -f publickey.ldif
</code></pre>

<h2 id="back-to-phpldapadmin">Back to phpLDAPadmin&nbsp;<a class="anchor" href="#back-to-phpldapadmin"><i class="small linkify icon"></i></a> </h2>

<p><img src="https://i.imgur.com/m2kQsay.png" alt="Imgur" /></p>

<h3 id="olcaccess">olcAccess&nbsp;<a class="anchor" href="#olcaccess"><i class="small linkify icon"></i></a> </h3>

<pre><code>{0}to attrs=userPassword by self write by dn=cn=admin,cn=config manage by anonymous auth by * none

{1}to attrs=shadowLastChange by self write by dn=cn=admin,cn=config manage by * read

{2}to attrs=ludoucredit by dn=cn=TA,ou=People,dc=0846101,dc=nasa write by dn=cn=admin,cn=config manage by * read

{3}to * by dn=cn=admin,cn=config manage by * read
</code></pre>

<h3 id="new-objectclass">New objectClass&nbsp;<a class="anchor" href="#new-objectclass"><i class="small linkify icon"></i></a> </h3>

<p>objectClass &gt; add value<br />
<img src="https://i.imgur.com/AA5008g.png" alt="Imgur" /></p>

<h4 id="ludou-1">ludou&nbsp;<a class="anchor" href="#ludou-1"><i class="small linkify icon"></i></a> </h4>

<p><img src="https://i.imgur.com/TTWThjn.png" alt="Imgur" />
100<br />
<img src="https://i.imgur.com/Qwxvlpy.png" alt="Imgur" /></p>

<h4 id="publickey-1">publicKey&nbsp;<a class="anchor" href="#publickey-1"><i class="small linkify icon"></i></a> </h4>

<p><img src="https://i.imgur.com/xOdc1Hp.png" alt="Imgur" />
Add new attribute<br />
<img src="https://i.imgur.com/uKa0Nj4.png" alt="Imgur" />
<img src="https://i.imgur.com/0BiqUZH.png" alt="Imgur" /></p>

<h1 id="starttls">STARTTLS&nbsp;<a class="anchor" href="#starttls"><i class="small linkify icon"></i></a> </h1>

<p><a href="https://www.digitalocean.com/community/tutorials/how-to-encrypt-openldap-connections-using-starttls">https://www.digitalocean.com/community/tutorials/how-to-encrypt-openldap-connections-using-starttls</a></p>

<h2 id="server-settings">Server Settings&nbsp;<a class="anchor" href="#server-settings"><i class="small linkify icon"></i></a> </h2>

<h3 id="install-the-ssl-components">Install the SSL Components&nbsp;<a class="anchor" href="#install-the-ssl-components"><i class="small linkify icon"></i></a> </h3>

<pre><code>sudo apt-get install gnutls-bin ssl-cert
</code></pre>

<h3 id="create-the-certificate-templates">Create the Certificate Templates&nbsp;<a class="anchor" href="#create-the-certificate-templates"><i class="small linkify icon"></i></a> </h3>

<p>Make a directory to store the template files</p>

<pre><code>sudo mkdir /etc/ssl/templates
</code></pre>

<h3 id="create-the-ca-template">Create the CA Template&nbsp;<a class="anchor" href="#create-the-ca-template"><i class="small linkify icon"></i></a> </h3>

<pre><code>sudo vim /etc/ssl/templates/ca_server.conf
</code></pre>

<pre><code>cn = LDAP Server CA
ca
cert_signing_key
</code></pre>

<h3 id="create-the-ldap-service-template">Create the LDAP Service Template&nbsp;<a class="anchor" href="#create-the-ldap-service-template"><i class="small linkify icon"></i></a> </h3>

<pre><code>sudo vim /etc/ssl/templates/ldap_server.conf
</code></pre>

<pre><code>organization = &quot;0846101.nasa&quot;
cn = 0846101.nasa
tls_www_server
encryption_key
signing_key
expiration_days = 3652
</code></pre>

<p>expiration days are 10 yrs</p>

<h3 id="create-ca-key-and-certificate">Create CA Key and Certificate&nbsp;<a class="anchor" href="#create-ca-key-and-certificate"><i class="small linkify icon"></i></a> </h3>

<p>Use the certtool utility to generate a private key</p>

<pre><code>sudo certtool -p --outfile /etc/ssl/private/ca_server.key
</code></pre>

<p>Now, we can use the private key that we just generated (<code>ca_server.key</code>) and the template file we created in the last section (<code>ca_server.conf</code>) to create the certificate authority certificate (<code>ca_server.pem</code>)</p>

<pre><code>sudo certtool -s --load-privkey /etc/ssl/private/ca_server.key --template /etc/ssl/templates/ca_server.conf --outfile /etc/ssl/certs/ca_server.pem
</code></pre>

<p>複製到家目錄</p>

<pre><code>sudo cp /etc/ssl/certs/ca_server.pem /home/c0846101/ca_server
</code></pre>

<p>在<code>/usr/local/share/ca-certificates</code>創一個資料夾</p>

<pre><code>sudo mkdir /usr/local/share/ca-certificates/nasa
</code></pre>

<p><code>ca_server.pem</code>要先轉成crt檔</p>

<pre><code>sudo mv /etc/ssl/certs/ca_server.pem /usr/local/share/ca-certificates/nasa/0846101.nasa.crt
</code></pre>

<p>才能合併到<code>/etc/ssl/certs/ca-certificates.crt</code></p>

<pre><code>sudo update-ca-certificates
</code></pre>

<p><img src="https://i.imgur.com/TrtJXO5.png" alt="Imgur" /></p>

<p><strong>Client(ws1.0846101.nasa)也要做CA憑證</strong></p>

<h3 id="create-ldap-service-key-and-certificate">Create LDAP Service Key and Certificate&nbsp;<a class="anchor" href="#create-ldap-service-key-and-certificate"><i class="small linkify icon"></i></a> </h3>

<pre><code>sudo certtool -p --sec-param high --outfile /etc/ssl/private/ldap_server.key
</code></pre>

<p>generate a certificate for the server.</p>

<pre><code>sudo certtool -c --load-privkey /etc/ssl/private/ldap_server.key --load-ca-certificate /etc/ssl/certs/ca_server.pem --load-ca-privkey /etc/ssl/private/ca_server.key --template /etc/ssl/templates/ldap_server.conf --outfile /etc/ssl/certs/ldap_server.pem
</code></pre>

<pre><code>openssl x509 -in /etc/ssl/certs/ldap_server.pem -text
</code></pre>

<h3 id="give-openldap-access-to-the-ldap-server-key">Give OpenLDAP Access to the LDAP Server Key&nbsp;<a class="anchor" href="#give-openldap-access-to-the-ldap-server-key"><i class="small linkify icon"></i></a> </h3>

<p>A group called ssl-cert already exists as the group-owner of the /etc/ssl/private directory. We can add the user our OpenLDAP process runs under (openldap) to this group</p>

<pre><code>sudo usermod -aG ssl-cert openldap
</code></pre>

<pre><code>sudo chown :ssl-cert /etc/ssl/private/ldap_server.key
</code></pre>

<p>give the ssl-cert group read access to the file</p>

<pre><code>sudo chmod 640 /etc/ssl/private/ldap_server.key
</code></pre>

<h3 id="configure-openldap-to-use-the-certificate-and-keys">Configure OpenLDAP to Use the Certificate and Keys&nbsp;<a class="anchor" href="#configure-openldap-to-use-the-certificate-and-keys"><i class="small linkify icon"></i></a> </h3>

<pre><code>vim addcerts.ldif
</code></pre>

<pre><code>dn: cn=config
changetype: modify
add: olcTLSCACertificateFile
olcTLSCACertificateFile: /etc/ssl/certs/ca_server.pem
-
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/ssl/certs/ldap_server.pem
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/ssl/private/ldap_server.key
</code></pre>

<pre><code>sudo ldapmodify -H ldapi:// -Y EXTERNAL -f addcerts.ldif
</code></pre>

<h2 id="client-settings">Client Settings&nbsp;<a class="anchor" href="#client-settings"><i class="small linkify icon"></i></a> </h2>

<p>ws1也要有CA憑證</p>

<pre><code>sudo mkdir /usr/local/share/ca-certificates/nasa
</code></pre>

<p>在ws1利用sftp抓取ldap1的<code>ca_server.pem</code></p>

<pre><code>sftp 10.113.25.10
</code></pre>

<pre><code>get ca_server.pem
</code></pre>

<pre><code>sudo mv ca_server.pem /usr/local/share/ca-certificates/nasa/0846101.nasa.crt
</code></pre>

<pre><code>sudo update-ca-certificates
</code></pre>

<p><a href="https://www.server-world.info/en/note?os=Ubuntu_18.04&amp;p=openldap&amp;f=3">https://www.server-world.info/en/note?os=Ubuntu_18.04&amp;p=openldap&amp;f=3</a>
<a href="https://www.tecmint.com/configure-ldap-client-to-connect-external-authentication/">https://www.tecmint.com/configure-ldap-client-to-connect-external-authentication/</a></p>

<pre><code>sudo apt install -y libnss-ldapd ldap-utils nslcd
</code></pre>

<p>Install <code>libness-ldapd</code> instead of <code>libness-ldap</code><br />
Install <code>nslcd</code> instead of <code>nscd</code><br />
    nscd會有cache的問題</p>

<p>安裝時會跑出<code>ldap-auth-config</code><br />
The results of the dialog will be stored in the file <code>/etc/ldap.conf</code></p>

<p>Configure the system to use LDAP for authentication by updating PAM configurations.<br />
From the menu, choose LDAP and any other authentication mechanisms you need.<br />
You should now be able to log in using LDAP-based credentials.</p>

<pre><code>sudo pam-auth-update
</code></pre>

<p>In case you want the home directory of the user to be created automatically, then you need to perform one more configuration in the common-session PAM file.</p>

<pre><code>sudo vim /etc/pam.d/common-session
</code></pre>

<p>add this to the bottom</p>

<pre><code>session required pam_mkhomedir.so skel=/etc/skel umask=077
</code></pre>

<p>Restart nslcd</p>

<pre><code>sudo systemctl restart nslcd
sudo systemctl enable nslcd
</code></pre>

<p>Testing</p>

<pre><code>ldapwhoami -H ldap://ldap1.0846101.nasa -x -ZZ
</code></pre>

<h2 id="dns-txt-record">DNS TXT Record&nbsp;<a class="anchor" href="#dns-txt-record"><i class="small linkify icon"></i></a> </h2>

<pre><code>cat ca_server.pem | base64 | sed -n 's/\(.*\)/&quot;\1&quot;/p'
</code></pre>

<pre><code>cert            IN      TXT     ( &quot;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQ2akNDQWxLZ0F3SUJBZ0lNWHVYVHJpNjFO&quot;
&quot;djRhWUFIc01BMEdDU3FHU0liM0RRRUJDd1VBTUJreEZ6QVYKQmdOVkJBTVREa3hFUVZBZ1UyVnlk&quot;
&quot;bVZ5SUVOQk1CNFhEVEl3TURZeE5EQTNNemN4T0ZvWERUSXhNRFl4TkRBMwpNemN4T0Zvd0dURVhN&quot;
&quot;QlVHQTFVRUF4TU9URVJCVUNCVFpYSjJaWElnUTBFd2dnR2lNQTBHQ1NxR1NJYjNEUUVCCkFRVUFB&quot;
&quot;NElCandBd2dnR0tBb0lCZ1FEaUhYWmY3VzdPRFk2K1lJMFRXa0s1WWpEbWxabDRXNU9ra1VGWTRw&quot;
&quot;WjYKNmM0SXREOExjV3EzbzgyL2Zmd0Zvb28rRGxTa3hEZHVaT0crb3BTYjhRRWZ5QjBXK2VROFh3&quot;
&quot;OUx0dzc1Z2l4TgpmRFRGVEk1dXZMM2x4bGo1dHdac09yUHkzNzE5U3hKNjNvMC9XckhWU2xKTnQx&quot;
&quot;dW5yYVA3elpCeU5BM0lOdDF2CnhXTXVKQVltSDlVN2JJZ0NnTFFUeWJPSi9ZVmpkYmNRYmkwcXZ1&quot;
&quot;ckU3cThLT2Rib01UM1RFMUpUSWE5U3NOL04KU1JlbWd5djJZNkJaWS94bE8vcFpWZllFUzUxSU1N&quot;
&quot;UmIxWlRMWUxyMXNsMGY0enBiRDdQZFJDNDhGUHBmTFhBQwpvREVlMUlsUXVjV1VlTzBJTnZaaUhh&quot;
&quot;eTlxQmtIOGg5WDNoMzZDZWpQeTA2U0hvVDBmV3h0QUtvRER4ZktEaDYyCjFlOEFuTWhMeTZQdmEr&quot;
&quot;dGx5YXQrenU4Mkp3czVZc2dBNmh1bGFQaE9sSS80UXcrZXorT2g0RjB6STJWa1Nta1gKT3J3NmlY&quot;
&quot;REFEb3h6U1lOSzRqdmZ3RS9MUzFITkt6ZytXQUNRVmxocStPL2RFZnRpaWVId2lEMURabUh5SmN4&quot;
&quot;VApYQlVaZkllMVJXeEhjdGtvZ3RCaVdQRUNBd0VBQWFNeU1EQXdEd1lEVlIwVEFRSC9CQVV3QXdF&quot;
&quot;Qi96QWRCZ05WCkhRNEVGZ1FVN01oQXBqWXB0ZU1TYkJSc1hWaEJOL25LQitrd0RRWUpLb1pJaHZj&quot;
&quot;TkFRRUxCUUFEZ2dHQkFMcWgKMnVyQTIrcjZOV1ZnSmZVVDVOdFhwNWJVZFlGUkFKUWhYc0dvbUx0&quot;
&quot;U3pDMGtsYXFVUlY2aFQvbjlMWFZQNG5ncApEMVgvaDVUTlJOVkNxRzZ4NmZ2MmhKMXNnVnVtcmtM&quot;
&quot;Q05qUnhXVVdQWm5ZNUFuc1Y4RWRRdEYwamo5cWtsT3pSCkZHRlVUcnRkSXBmaERuUzRCVVlhL050&quot;
&quot;QjY4U0haWlhiWTNyKzdXSG0xZ2JpUG5yT1VFeGpsY3hmZGNKUWtveUsKTVM3NkFBbE9FV2NZT3dQ&quot;
&quot;RktDcVlMekhLYWh2dXdXNEU1UDRDRmhOU004TGwxMml6Uk52UWxGbkZMMytUck42bAp3YzdWMkFB&quot;
&quot;N2dmczE1N0s5ZVZENXUwdCt4T0djMzZGU1NkY2ZoUjZmdDJVWVNMS0U3ZUNBdEdNbzRXVC8xUHBa&quot;
&quot;CldUNlM4T3VEaUY1a1B2dlNCcFhwVFM4YUY3SVp6ZjJ3Tk9QMEQrbnJXdXoyOHhyT2YwQmNlWHZU&quot;
&quot;eG94b0dxV1oKVVliNVZ2U1NWUTlNdlg4QVFpSVV0SHZPSkJGYkQ5dFdWS1MvN0hyc0VXL1lpMjhP&quot;
&quot;b0dFWEpzejNxUlFwYytqVAoxWlppajViV0tUWldoMGNKdmtGZWVFaGc1Rm9ZenJzdnpvcGRwalcw&quot;
&quot;V25ISEdjczlLekxuNE9Pa2lEWS9Udz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K&quot; )
</code></pre>

<pre><code>sudo systemctl restart named
</code></pre>

<p>DNSSEC要記得重簽</p>

<h1 id="specs-of-ludoucredit-about-user-account-and-ssh-login">Specs of ludouCredit about User Account and SSH Login:&nbsp;<a class="anchor" href="#specs-of-ludoucredit-about-user-account-and-ssh-login"><i class="small linkify icon"></i></a> </h1>

<ul>
<li><p>If some users’ ludoucredit &gt; 0, they can login via SSH.</p></li>

<li><p>If some users’ ludoucredit == 0, they can’t login via SSH
with TA’s private key, but their account still exist on the
system.</p></li>

<li><p>If some users’ ludoucredit &lt; 0, they can’t login via SSH
and their account will be disappeared on the LDAP master and Workstation. (i.e. id: user: no such user)</p></li>
</ul>

<p>可以<code>man ldapsearch</code>看一下</p>

<pre><code>vim login.sh
</code></pre>

<pre><code>#!/bin/bash
ldapsearch -x -H ldap://ldap1.0846101.nasa -b &quot;ou=People,dc=0846101,dc=nasa&quot; -o ldif-wrap=no -ZZ -LLL &quot;(&amp;(uid=$1)(ludoucredit&gt;=1))&quot; sshPublicKey | sed -n &quot;s/^sshPublicKey: \(.*\)/\1/p&quot;
</code></pre>

<p>-o ldif-wrap=no &ndash;&gt; 讓sshPublicKey不換行呈現</p>

<p>測試一下：</p>

<pre><code>ls -l login.sh
chmod 755 login.sh
./login.sh TA
./login.sh 0846101
./login.sh taipeirioter
</code></pre>

<p>更改<code>sshd_config</code></p>

<pre><code>sudo vim /etc/ssh/sshd_config
</code></pre>

<pre><code>AuthorizedKeysCommand /usr/local/bin/login.sh %u
AuthorizedKeysCommandUser nobody
</code></pre>

<p>%u &ndash;&gt; user</p>

<pre><code>sudo systemctl reload sshd
</code></pre>

<p>使用nslcd濾掉不能登入的user的passwd</p>

<pre><code>sudo vim /etc/nslcd.conf
</code></pre>

<pre><code>filter passwd (&amp;(objectClass=posixAccount)(ludoucredit&gt;=0))
</code></pre>

<pre><code>sudo systemctl restart nslcd
</code></pre>

<p>若不能登入會查不到</p>

<pre><code>getent passwd
</code></pre>

<h1 id="totp">TOTP&nbsp;<a class="anchor" href="#totp"><i class="small linkify icon"></i></a> </h1>

<p><a href="https://blog.irontec.com/openldap-y-passwords-temporales-otp/">https://blog.irontec.com/openldap-y-passwords-temporales-otp/</a></p>

<pre><code>sudo vim /etc/apt/sources.list
</code></pre>

<p>全部的deb-src都取消註解</p>

<pre><code>sudo apt update
sudo apt build-dep slapd
sudo apt install dpkg-dev
sudo apt install build-essential
</code></pre>

<pre><code>apt source slapd
</code></pre>

<pre><code>cd openldap-2.4.45+dfsg
</code></pre>

<pre><code>./configure --prefix=/usr --libexecdir='${prefix}/lib' --sysconfdir=/etc --localstatedir=/var --mandir='${prefix}/share/man' --enable-debug --enable-dynamic --enable-syslog --enable-proctitle --enable-ipv6 --enable-local --enable-slapd --enable-dynacl --enable-aci --enable-cleartext --enable-crypt --disable-lmpasswd --enable-spasswd --enable-modules --enable-rewrite --enable-rlookups --enable-slapi --disable-slp --enable-wrappers --enable-backends=mod --disable-ndb --enable-overlays=mod --with-subdir=ldap --with-cyrus-sasl --with-threads --with-tls=gnutls --with-odbc=unixodbc
</code></pre>

<pre><code>make depend
</code></pre>

<pre><code>vim liblber/Makefile
vim libldap/Makefile
vim libldap_r/Makefile
</code></pre>

<p>把<code>VERSION_OPTION = @VERSION_OPTION@</code><br />
替代為<code>VERSION_OPTION = ./</code></p>

<pre><code>cd libraries
make
</code></pre>

<pre><code>cd ..
make
</code></pre>

<p>debug</p>

<pre><code>dpkg-buildpackage -b
sudo apt-get install fakeroot
dpkg-buildpackage -b
</code></pre>

<pre><code>cd 
git clone https://github.com/openldap/openldap.git openldap-git
</code></pre>

<pre><code>cp -r openldap-git/contrib/slapd-modules/passwd/totp openldap-2.4.45+dfsg/contrib/slapd-modules/passwd/

</code></pre>

<pre><code>cd openldap-2.4.45+dfsg/
make
</code></pre>

<pre><code>cd openldap-2.4.45+dfsg/ontrib/slapd-modules/passwd/totp
make
</code></pre>

<pre><code>vim slapd-totp.c
</code></pre>

<p>Line 961<br />
<img src="https://i.imgur.com/mMtvyZx.png" alt="Imgur" /></p>

<pre><code>make
</code></pre>

<pre><code>sudo chmod 644 /usr/lib/ldap/pw-totp.so.0.0.0
</code></pre>

<pre><code>sudo cp -P pw-totp.so* /usr/lib/ldap/
</code></pre>

<h2 id="configure-module-totp">Configure Module TOTP&nbsp;<a class="anchor" href="#configure-module-totp"><i class="small linkify icon"></i></a> </h2>

<p>創user cn=totp,ou=People
passwd先空白</p>

<p>userPassword: &ldquo;{TOTP1}<code>printf ${WG_KEY} | base32</code>&ldquo;</p>

<pre><code>echo -n 'UBZQOTHSmqy4Tn+6kuMGfKY00GwG+24MBIKiIqKzkW4=' | base32
</code></pre>

<pre><code>sudo vim totppasswd.ldif
</code></pre>

<pre><code>dn: cn=totp,ou=People,dc=0846101,dc=nasa
changetype: modify
add: userPassword
userPassword: {TOTP1}KVBFUUKPKREFG3LRPE2FI3RLGZVXKTKHMZFVSMBQI53UOKZSGRGUESKLNFEXCS32NNLTIPI=
</code></pre>

<pre><code>ldapmodify -D &quot;cn=admin,cn=config&quot; -W -f totppasswd.ldif
</code></pre>

<p><img src="https://i.imgur.com/xiIIlkh.png" alt="Imgur" /></p>

<p><img src="https://i.imgur.com/uG4u5h6.png" alt="Imgur" /></p>

<pre><code>sudo vim addmodule.ldif
</code></pre>

<pre><code>dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: pw-totp
</code></pre>

<pre><code>sudo ldapadd -Y EXTERNAL -H ldapi:/// -f addmodule.ldif
</code></pre>

<p><img src="https://i.imgur.com/FZLfw5g.png" alt="Imgur" /></p>

<p>測試</p>

<pre><code>su totp
</code></pre>

<p>secret最後的 <code>=</code> 要拔掉<br />
<img src="https://i.imgur.com/AZ2DAt1.png" alt="Imgur" /></p>

<pre><code>otpauth://totp/ldap:totp@0846101.nasa?secret=KVBFUUKPKREFG3LRPE2FI3RLGZVXKTKHMZFVSMBQI53UOKZSGRGUESKLNFEXCS32NNLTIPI&amp;issuer=0846101&amp;period=30&amp;digits=6&amp;algorithm=SHA1
</code></pre>

<pre><code>oathtool --totp -b &quot;$(echo -n &quot;UBZQOTHSmqy4Tn+6kuMGfKY00GwG+24MBIKiIqKzkW4=&quot; | base32)&quot;
</code></pre>

<h1 id="snmp">SNMP&nbsp;<a class="anchor" href="#snmp"><i class="small linkify icon"></i></a> </h1>

<pre><code>sudo apt-get install snmpd snmp snmp-mibs-downloader
</code></pre>

<p>snmpd &ndash;&gt; server<br />
snmp &ndash;&gt; client</p>

<pre><code>sudo vim /etc/snmp/snmpd.conf
</code></pre>

<p>Listen for connections on all interfaces</p>

<pre><code>#agentAddress  udp:127.0.0.1:161
agentAddress udp:161,udp6:[::1]:161
</code></pre>

<p>Community &ldquo;public&rdquo;</p>

<pre><code>rocommunity public 10.113.0.0/16
rocommunity public 127.0.0.0/8
</code></pre>

<p>Community &ldquo;private&rdquo;</p>

<pre><code>rwcommunity private 10.113.25.0/24
rwcommunity private 127.0.0.0/8
</code></pre>

<p>Write an extend named &ldquo;servicecheck&rdquo;<br />
- Check the connection to tcp:10.113.25.129:5566<br />
- If connected, nsExtendResult should be 0<br />
- If not connected, nsExtendResult should not be 0</p>

<pre><code>extend servicecheck /bin/nc -z 10.113.25.129 5566
</code></pre>

<pre><code>sudo systemctl restart snmpd
</code></pre>

<pre><code>snmpget -v2c -c public -Oqv localhost UCD-SNMP-MIB::laLoad.1
</code></pre>

<pre><code>snmpget -v2c -c public -Oqv localhost SNMPv2-MIB::sysName.0
</code></pre>

<pre><code>snmpget -v2c -c public -Oqv localhost 'NET-SNMP-EXTEND-MIB::nsExtendResult.&quot;servicecheck&quot;'
</code></pre>

<h1 id="firewall">Firewall&nbsp;<a class="anchor" href="#firewall"><i class="small linkify icon"></i></a> </h1>

<p>在<code>router.0846101.nasa</code></p>

<pre><code>-A INPUT -d 10.113.25.10 -p tcp --dport 22 -j ACCEPT
-A INPUT -d 10.113.25.20 -p tcp --dport 22 -j ACCEPT

-A FORWARD -d 10.113.25.10 -p tcp --dport 22 -j ACCEPT
-A FORWARD -d 10.113.25.20 -p tcp --dport 22 -j ACCEPT

-A FORWARD -p tcp --dport 389 -j ACCEPT
-A FORWARD -p udp --dport 161 -j ACCEPT
</code></pre>

<pre><code>sudo systemctl restart iptables
</code></pre>

                </section>
        
            </div>
	     </div>



     </div>
  </div>
</main>
<footer class="sand">

	<a href="https://www.facebook.com/beatboxyilianwu" target="_blank"><img src="https://i.imgur.com/EJhxgWk.png" height="30" width="30"></a>
	<a href="https://twitter.com/YiLianWu" target="_blank"><img src="https://i.imgur.com/KvvGcoN.png" height="30" width="30"></a>
	<a href="https://www.instagram.com/weelian/" target="_blank"><img src="https://i.imgur.com/FVUwWv0.png" height="30" width="30"></a>
	
	<a href="https://github.com/yilianwu" target="_blank"><img src="https://i.imgur.com/BIgEqmF.png" height="30" width="30"></a>
	<a href="https://www.linkedin.com/in/yilianwu/" target="_blank"><img src="https://i.imgur.com/hCGvLEq.png" height="30" width="30"></a>

    <span style="display:block" class="footer-text">&copy 2019-2020 吳羿璉. All rights reserved. Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span>
</footer>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "left"
    });
</script>
<script type="text/javascript"
	src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script> 
<link rel="stylesheet" href="https://yilianwu.github.io/css/solarized-light.css"/>
<script src="https://yilianwu.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
